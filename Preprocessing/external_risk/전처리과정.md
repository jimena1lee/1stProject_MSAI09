# EDA 데이터 전처리 요약 (eda_data.ipynb)

> 데이터 출처: 공공데이터포털(data.go.kr), 경기데이터드림(data.gg.go.kr)  
> 전처리 대상: 경기도 성남시 외부 안전위험요소 관련 데이터셋

---

~~ ## 1. 경기도 초등학교 현황 -> 1-1.의 어린이보호구역현황 데이터를 사용 ~~ 

**출처:** https://data.gg.go.kr (경기도 공공데이터)  
**원본 파일:** `경기도_초등학교현황.csv`

### 전처리 과정

| 단계 | 내용 |
|------|------|
| 결측치 확인 | 위도, 경도, 우편번호 등 일부 컬럼에 결측치 존재 확인 |
| 결측치 제거 | 결측치 포함 행 제거 (해당 행들이 성남시 외 데이터로 판단) |

> ※ 이후 어린이보호구역 현황 데이터로 대체 사용 (1-1 참고)

### 전처리 후 데이터 속성

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| 설립구분명 | object | 공립/사립 구분 |
| 시설명 | object | 학교명 |
| 전화번호 | object | 연락처 |
| 소재지지번주소 | object | 지번 주소 |
| 소재지도로명주소 | object | 도로명 주소 |
| 소재지우편번호 | float64 | 우편번호 |
| WGS84위도 | float64 | 위도 좌표 |
| WGS84경도 | float64 | 경도 좌표 |

**전처리 후 행 수:** 1,381건  

---

## 1-1. 어린이 보호구역 현황 (메인 데이터로 사용)

**출처:** https://data.gg.go.kr  
**원본 파일:** `어린이보호구역현황_(성남시).csv`  
**수집 일자:** ~ 2025-11-11

### 전처리 과정

| 단계 | 내용 |
|------|------|
| 컬럼 선택 | 12개 원본 컬럼 중 핵심 6개만 추출 (시설종류, 대상시설명, 주소 2종, 위도, 경도) |
| 타입 변환 | 위도·경도 컬럼을 float64로 명시적 변환 |
| 저장 | `성남화성시_어린이보호구역_위치정보.csv` |

### 전처리 후 데이터 속성

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| 시설종류 | object | 유치원 / 초등학교 구분 |
| 대상시설명 | object | 시설명 |
| 소재지도로명주소 | object | 도로명 주소 |
| 소재지지번주소 | object | 지번 주소 |
| 위도 | float64 | WGS84 위도 |
| 경도 | float64 | WGS84 경도 |

**전처리 후 행 수:** 142건  

---

## 2. 경기도 아동안전지킴이집 현황

**출처:** https://data.go.kr  
**원본 파일:** `경기도아동안전지킴이집현황.csv`

### 전처리 과정

| 단계 | 내용 |
|------|------|
| 지역 필터링 | `소재지도로명주소` 컬럼에 '성남' 포함된 행만 추출 |
| 결측치 확인 | `현존주소여부 == 'F'` (현존하지 않는 시설) 70건 확인 |
| 불량 데이터 제거 | `현존주소여부 == 'F'` AND (위도 or 경도가 NaN)인 행 70건 제거 |
| 컬럼 제거 | `안전시설전화번호` 컬럼 제거 |
| 저장 | `아동안전지킴이집현황_전처리.csv` |

### 전처리 후 데이터 속성

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| 안전시설명 | object | 시설명 |
| 소재지도로명주소 | object | 도로명 주소 (일부 결측) |
| 소재지지번주소 | object | 지번 주소 |
| 위도 | float64 | WGS84 위도 |
| 경도 | float64 | WGS84 경도 |
| 현존주소여부 | object | T/F (현존 여부) |

**전처리 후 행 수:** 121건  
> ※ `소재지도로명주소` 250건, `안전시설전화번호`(제거 전) 398건 결측 존재

---

## 3. 성남시 주민등록 인구 현황

**출처:** 성남시 공공데이터  
**수집 일자:** 2026-01-31 기준

### 전처리 과정

| 단계 | 내용 |
|------|------|
| 컬럼 정리 | 연령별 세부 인구 컬럼에서 분석에 필요한 컬럼 선별 사용 |
| 동 단위 집계 | 구별 + 동별 인구 수치 유지 |

### 전처리 후 데이터 속성

| 컬럼명 | 설명 |
|--------|------|
| 구별 | 수정구 / 중원구 / 분당구 |
| 동 | 행정동명 |
| 인구수_계 | 전체 인구 |
| 인구수_남 / 여 | 성별 인구 |
| 19세 이상_계 / 남 / 여 | 성인 인구 |
| 65세 이상_계 / 남 / 여 | 노인 인구 |
| 세대수 | 세대 수 |
| 재외국민 | 재외국민 수 |
| 데이터기준일자 | 기준일 (2026-01-31) |

---

~~ ## 4. 경기도 성남시 관공서 및 주요기관 정보 (경찰서) ~~ 

**출처:** https://www.data.go.kr/data/15032489, https://www.data.go.kr/data/15077036  
**수집 일자:** 2025-11-26

### 전처리 과정

| 단계 | 내용 |
|------|------|
| 기관 유형 필터링 | 전체 관공서 중 경찰서·지구대·파출소 관련 행만 추출 |

### 전처리 후 데이터 속성

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| 구 분 | object | 구별 분류 |
| 기관명 | object | 경찰서/지구대/파출소명 |
| 소 재 지 | object | 주소 |
| 관할구역 | object | 담당 구역 |
| 전화번호 | object | 연락처 |
| 데이터기준일자 | object | 기준일 |

**전처리 후 행 수:** 28건 (성남시 내 경찰 기관)

---

~~ ## 5. 경찰청 전국 지구대·파출소 주소 현황 ~~

**출처:** 경찰청 공공데이터  
**원본 파일:** `경찰청_전국 지구대 파출소 주소 현황_20251231.csv`

### 전처리 과정

| 단계 | 내용 |
|------|------|
| 지역 필터링 | `시도청 == '경기남부청'` 중 성남·화성 경찰서 소속만 추출 |
| 지오코딩 | Naver Map API를 활용해 주소 → 위도/경도 변환 (`get_coordinates` 함수) |
| 결측치 재시도 | 지오코딩 실패 시 상세주소 앞 4단어만 사용하여 재시도 |
| NaN 제거 | 재시도 후에도 NaN 없음 확인 (최종 0건) |
| 저장 | `경기도성남시_지구대_파출소_위치정보.csv` / `성남화성시_지구대_파출서_위치정보.csv` |

### 전처리 후 데이터 속성

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| 구 분 | object | 소속 구(분당구, 수정구 등) |
| 기관명 | object | 지구대/파출소명 |
| 주소 | object | 도로명 주소 |
| 위도 | float64 | 지오코딩 결과 위도 |
| 경도 | float64 | 지오코딩 결과 경도 |

**전처리 후 행 수:** 45건 (성남+화성 통합)  

---

## 전처리 데이터 요약 테이블

| 데이터셋 | 전처리 후 행 수 | 주요 컬럼 수 | 주요 전처리 내용 |
|----------|:--------------:|:-----------:|----------------|
| 어린이 보호구역 현황 | 142건 | 6개 | 컬럼 선별, 타입 변환 |
| 아동안전지킴이집 현황 | 121건 | 6개 | 지역 필터, 불량 데이터 제거, 전화번호 제거 |
| 초등학교 현황 | 1,381건 | 8개 | 결측치 행 제거 |
| 관공서(경찰서) 현황 | 28건 | 6개 | 기관 유형 필터 |
| 지구대·파출소 현황 | 45건 | 5개 | 지역 필터, 주소 지오코딩 |

---

## 공통 전처리 함수

```python
# 두 좌표 간 거리 계산 (Haversine 공식)
def haversine(lat1, lon1, lat2, lon2):
    R = 6371  # 지구 반경 km
    lat1, lon1, lat2, lon2 = map(np.radians, [lat1, lon1, lat2, lon2])
    dlat = lat2 - lat1
    dlon = lon2 - lon1
    a = np.sin(dlat/2)**2 + np.cos(lat1)*np.cos(lat2)*np.sin(dlon/2)**2
    return R * 2 * np.arcsin(np.sqrt(a))

# 가장 가까운 어린이보호구역 시설 찾기 (벡터 연산)
def find_nearest_school(point_df, safezone_df):
    distances = haversine(
        point_df['위도'].values, point_df['경도'].values,
        safezone_df['위도'].values, safezone_df['경도'].values
    )
    nearest_idx = np.argmin(distances)
    return safezone_df.iloc[nearest_idx]['시설명']
```